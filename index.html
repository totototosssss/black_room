<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜IQ æ—©æŠ¼ã—ç™ºè¨€ã‚¯ã‚¤ã‚º</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f5f6f6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        h1 { color: #00B900; }
        .info-panel, #game-area, #result-screen {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #name-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        .name-badge {
            background: #e1f5e1;
            color: #007a00;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        #question-text {
            font-size: 1.5em;
            line-height: 1.6;
            min-height: 100px;
            text-align: left;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 8px;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }
        .btn {
            background-color: #00B900;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1.1em;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.2s;
            margin: 5px;
        }
        .btn:hover { background-color: #009900; }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }
        #buzzer-btn {
            background-color: #ff4d4d;
            font-size: 1.5em;
            padding: 20px 40px;
            border-radius: 50px;
        }
        #buzzer-btn:hover { background-color: #e60000; }
        #choices-area {
            display: none;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        .choice-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 1em;
            border-radius: 5px;
            cursor: pointer;
        }
        .choice-btn:hover { background-color: #0056b3; }
        .stats {
            display: flex;
            justify-content: space-around;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .combo { color: #ff8c00; font-size: 0.9em; }
        #player-name-input {
            padding: 10px;
            font-size: 1.2em;
            border: 2px solid #00B900;
            border-radius: 5px;
            width: 60%;
            margin-bottom: 15px;
            text-align: center;
        }
        .ranking-list {
            text-align: left;
            max-width: 400px;
            margin: 0 auto;
            font-size: 1.2em;
            line-height: 1.8;
            padding-left: 0;
            list-style: none;
        }
        .ranking-list li {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
        }
        .ranking-list li:nth-child(1) { font-weight: bold; color: gold; font-size: 1.4em; }
        .ranking-list li:nth-child(2) { font-weight: bold; color: silver; font-size: 1.3em; }
        .ranking-list li:nth-child(3) { font-weight: bold; color: #cd7f32; font-size: 1.2em; }
    </style>
</head>
<body>

    <h1>ğŸ’¬ ãƒˆãƒ¼ã‚¯æ—©æŠ¼ã—ã‚¯ã‚¤ã‚º</h1>
    
    <div class="stats" id="game-stats" style="display: none;">
        <div>ã‚¹ã‚³ã‚¢: <span id="score">0</span> ç‚¹ <span id="combo-text" class="combo"></span></div>
        <div>å•é¡Œ: <span id="question-count">0</span> / 7</div>
    </div>

    <div class="info-panel" id="start-screen">
        <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç™»éŒ²</h2>
        <input type="text" id="player-name-input" placeholder="ã‚ãªãŸã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" oninput="checkInput()">
        <br>
        <button class="btn" id="start-btn" onclick="startGame()" disabled>ã‚²ãƒ¼ãƒ é–‹å§‹</button>

        <h3 style="margin-top: 30px;">ç™»å ´ã™ã‚‹äººç‰©</h3>
        <div id="name-list"></div>
    </div>

    <div id="game-area" style="display: none;">
        <div id="question-text"></div>
        
        <div id="action-area">
            <button id="buzzer-btn" onclick="hitBuzzer()">ğŸ”´ æ—©æŠ¼ã—ï¼</button>
        </div>

        <div id="choices-area"></div>
        
        <div id="result-message" style="margin-top: 15px; font-weight: bold; font-size: 1.2em;"></div>
        <button class="btn" id="next-btn" style="display: none; margin-top: 15px;" onclick="nextQuestion()">æ¬¡ã®å•é¡Œã¸</button>
    </div>

    <div id="result-screen" style="display: none;">
        <h2>ã‚²ãƒ¼ãƒ çµ‚äº†ï¼</h2>
        <p style="font-size: 1.5em;">æœ€çµ‚ã‚¹ã‚³ã‚¢: <strong id="final-score-text"></strong> ç‚¹</p>
        
        <h3 style="margin-top: 30px; color: #00B900;">ğŸ† ã‚¹ã‚³ã‚¢ãƒ©ãƒ³ã‚­ãƒ³ã‚° ğŸ†</h3>
        <ul class="ranking-list" id="leaderboard-list"></ul>

        <br>
        <button class="btn" style="margin-top: 20px;" onclick="location.reload()">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>

<script>
    const quizData = [
        { name: "ã—ã‚", text: "ãã‚‡ã†ã¦æ•°1ã®å•é¡Œã§å‘†ã‚Œã¦è¨€è‘‰ã§ãªã„ã‚ˆ" },
        { name: "ã„ã‹", text: "å…·ä½“çš„ã§ç¾å®Ÿçš„ãªåœ°åŸŸåŒ»ç™‚ã¸ã®è²¢çŒ®ã£ã¦ãªã‚“ã‚¹ã‚«(ã´ãˆã‚“)" },
        { name: "ã„ãªãŒãã”ã‚ã†", text: "ä¿å¥å­¦ç§‘ãªã‚“ã§ã„ã‹ãªã„ã®ï¼Ÿ" },
        { name: "ã‚ã„ã“", text: "ä»Šæ—¥åœŸç”°ã‹ã‚‰èã„ãŸè©±ãªã‚“ã ã¨æ€ã£ã¦è¨€ã£ã¦ãŸã€‚" },
        { name: "ãªã‚“ã", text: "æ•™ãˆãŸã ã‘ã ã‘ã©ã€ãã‚Œã¯ãƒã‚¤ã‚¢ã‚¹ãŒã‹ã‹ã£ã¦ã‚‹" },
        { name: "ãŠã‚€ã‚Œã¤", text: "ã“ã‚Œã¯ã‚ªãƒ ãƒ¬ãƒ„ã®15æ–‡å­—ä»¥ä¸Šã®ç™ºè¨€ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚" },
        { name: "ãƒ•ãƒªã‚«ãƒ•ã‚£", text: "ã“ã‚Œã¯ãƒ•ãƒªã‚«ãƒ•ã‚£ã®15æ–‡å­—ä»¥ä¸Šã®ç™ºè¨€ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚" },
        { name: "ã‚‚ãã¸ã‚“", text: "ã“ã‚Œã¯ã‚‚ãã¸ã‚“ã®15æ–‡å­—ä»¥ä¸Šã®ç™ºè¨€ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚" },
        { name: "åœŸç”°", text: "ã“ã‚Œã¯åœŸç”°ã®15æ–‡å­—ä»¥ä¸Šã®ç™ºè¨€ã‚µãƒ³ãƒ—ãƒ«ã«ãªã‚Šã¾ã™ã€‚" }
    ];

    let uniqueNames = [...new Set(quizData.map(q => q.name))].sort();
    let currentQuestion = null;
    let questionText = "";
    let displayInterval = null;
    let currentIndex = 0;
    let score = 0;
    let qCount = 0;
    let combo = 0;
    let startTime = 0;
    let buzzerTime = 0;
    let playerName = "";
    const MAX_QUESTIONS = 7;

    const nameListDiv = document.getElementById("name-list");
    uniqueNames.forEach(name => {
        const span = document.createElement("span");
        span.className = "name-badge";
        span.textContent = name;
        nameListDiv.appendChild(span);
    });

    function checkInput() {
        const inputVal = document.getElementById("player-name-input").value.trim();
        document.getElementById("start-btn").disabled = inputVal === "";
    }

    function startGame() {
        playerName = document.getElementById("player-name-input").value.trim();
        document.getElementById("start-screen").style.display = "none";
        document.getElementById("game-stats").style.display = "flex";
        document.getElementById("game-area").style.display = "block";
        score = 0;
        qCount = 0;
        combo = 0;
        document.getElementById("score").textContent = score;
        nextQuestion();
    }

    function nextQuestion() {
        if (qCount >= MAX_QUESTIONS) {
            endGame();
            return;
        }
        
        qCount++;
        document.getElementById("question-count").textContent = qCount;
        document.getElementById("result-message").textContent = "";
        document.getElementById("next-btn").style.display = "none";
        document.getElementById("choices-area").style.display = "none";
        document.getElementById("buzzer-btn").style.display = "inline-block";
        
        currentQuestion = quizData[Math.floor(Math.random() * quizData.length)];
        questionText = currentQuestion.text;
        currentIndex = 0;
        document.getElementById("question-text").textContent = "";

        startTime = Date.now();
        
        displayInterval = setInterval(() => {
            if (currentIndex < questionText.length) {
                document.getElementById("question-text").textContent += questionText[currentIndex];
                currentIndex++;
            } else {
                clearInterval(displayInterval);
                hitBuzzer(true);
            }
        }, 350);
    }

    function hitBuzzer(auto = false) {
        clearInterval(displayInterval);
        buzzerTime = Date.now();
        document.getElementById("buzzer-btn").style.display = "none";
        showChoices();
    }

    function showChoices() {
        const choicesArea = document.getElementById("choices-area");
        choicesArea.innerHTML = "";
        choicesArea.style.display = "flex";

        let choices = [...uniqueNames];
        choices.sort(() => Math.random() - 0.5);

        choices.forEach(name => {
            const btn = document.createElement("button");
            btn.className = "choice-btn";
            btn.textContent = name;
            btn.onclick = () => checkAnswer(name);
            choicesArea.appendChild(btn);
        });
    }

    function checkAnswer(selectedName) {
        document.getElementById("choices-area").style.display = "none";
        const resultMsg = document.getElementById("result-message");
        
        if (selectedName === currentQuestion.name) {
            combo++;
            let basePoint = 50;
            
            let hiddenRatio = 1.0 - (currentIndex / questionText.length);
            let speedBonus = Math.floor(hiddenRatio * 100); 
            
            let comboBonus = (combo > 1) ? (combo * 10) : 0;

            let points = basePoint + speedBonus + comboBonus;
            score += points;

            document.getElementById("score").textContent = score;
            if (combo > 1) {
                document.getElementById("combo-text").textContent = `(${combo}é€£ãƒãƒ£ãƒ³!)`;
            }

            resultMsg.innerHTML = `æ­£è§£ï¼ğŸ‰<br>åŸºæœ¬ç‚¹:+${basePoint} æ—©æŠ¼ã—ãƒœãƒ¼ãƒŠã‚¹:+${speedBonus} é€£ç¶šãƒœãƒ¼ãƒŠã‚¹:+${comboBonus} (åˆè¨ˆ:+${points}ç‚¹)<br>æ­£ç­”: ${currentQuestion.name}`;
            resultMsg.style.color = "green";
        } else {
            combo = 0;
            score -= 100;
            document.getElementById("score").textContent = score;
            document.getElementById("combo-text").textContent = "";
            resultMsg.textContent = `æ®‹å¿µï¼âŒ -100ç‚¹... æ­£è§£ã¯ã€Œ${currentQuestion.name}ã€ã§ã—ãŸã€‚`;
            resultMsg.style.color = "red";
        }

        document.getElementById("question-text").textContent = questionText;
        document.getElementById("next-btn").style.display = "inline-block";
    }

    function endGame() {
        document.getElementById("game-area").style.display = "none";
        document.getElementById("game-stats").style.display = "none";
        document.getElementById("result-screen").style.display = "block";
        document.getElementById("final-score-text").textContent = score;

        let highScores = JSON.parse(localStorage.getItem("quizHighScores")) || [];
        
        let existingIndex = highScores.findIndex(entry => entry.name === playerName);
        if (existingIndex !== -1) {
            if (score > highScores[existingIndex].score) {
                highScores[existingIndex].score = score;
            }
        } else {
            highScores.push({ name: playerName, score: score });
        }

        highScores.sort((a, b) => b.score - a.score);
        localStorage.setItem("quizHighScores", JSON.stringify(highScores));

        let leaderboardHtml = "";
        highScores.slice(0, 10).forEach((entry, index) => {
            let rank = index + 1;
            let rankIcon = rank === 1 ? "ğŸ¥‡" : rank === 2 ? "ğŸ¥ˆ" : rank === 3 ? "ğŸ¥‰" : `${rank}.`;
            leaderboardHtml += `<li><span>${rankIcon} ${entry.name}</span> <span>${entry.score} ç‚¹</span></li>`;
        });
        document.getElementById("leaderboard-list").innerHTML = leaderboardHtml;
    }
</script>
</body>
</html>
